{% extends "ttn/community/base.html" %}
{% load staticfiles markup %}

{% block author %}
                {% for leader in community.leaders.all %}
                <div class="leader">
                    <img class="inititator" src="{% if leader.ttnuser.image_thumb_url %}{{ leader.ttnuser.image_thumb_url }}{% else %}{% static 'ttn/media/team/newmember.png' %}{% endif %}">
                    <h2 class="initiator-name">{{ leader.first_name }} {{ leader.last_name }}</h2>
                    <h3 class="initiator-city">{% if leader.tagline %}{{ leader.tagline }}{% else %}Initiator for {{ community.title }}{% endif %}</h3>
                </div>
                {% endfor %}
{% endblock %}

{% block extra_js %}
<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script>
      function initialize() {
        var mapCanvas = document.getElementById('map');
        var mapOptions = {
          center: new google.maps.LatLng(
                {{ community.lat|default:'44.5403' }},
                {{ community.lon|default:'-78.5463' }}),
          zoom: {{ community.scale|default:13 }},
          scrollwheel: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)

        var gateways = [];
        var colours = {'PL': '#0000DD', 'AC': '#00DD00',
                       'MA': '#80A000', 'DE': '#995555'};
        var opacities = {'DE': 0.2, 'PL': 0.3, 'MA': 0.5, 'AC': 0.5};
        function shadeColor(color, percent) {  
            percent = percent || 10;
            var num = parseInt(color.slice(1),16), amt = Math.round(2.55 * percent);
            var R = (num >> 16) + amt, G = (num >> 8 & 0x00FF) + amt, B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000
                       + (G<255?G<1?0:G:255)*0x100
                       + (B<255?B<1?0:B:255)).toString(16).slice(1);
        }
        {% with 'DE PL MA AC' as statuses %}
        {% for status in statuses.split %}
            {% for gw in community.gateways.all %}
                {% if gw.status == status %}
                var colour = colours['{{ gw.status }}'] || '#333333';
                var opacity = opacities['{{ gw.status }}'] || 0.8;
                gateways.push(new google.maps.Circle({
                    strokeColor: shadeColor(colour, 20),
                    strokeOpacity: opacity,
                    strokeWeight: 1,
                    fillColor: colour,
                    fillOpacity: opacity,
                    map: map,
                    center: {lat: {{ gw.lat|default:0 }}, lng: {{ gw.lon|default:0 }} },
                    radius: {{ gw.rng|default:5000 }}
                }));
                {% endif %}
            {% endfor %}
        {% endfor %}
        {% endwith %}
      }
      google.maps.event.addDomListener(window, 'load', initialize);
</script>
{% endblock %}


{% block content %}
            <article class="intro">
                <h1>We are on a mission to build a global open crowdsourced Internet of Things data network.</h1>

                <div class="intro-mission">
                    {% if community.mission %}
                        {{ community.mission|markdown }}
                    {% else %}
                        <p>{{ community.leaders.first.first_name }} {{ community.leaders.first.last_name }} has taken the job upon him to rollout The Things Network in {{ community.title }}.</p>
                    {% endif %}
                </div>

                {% if community.description %}
                <div class="page-content">
                    {{ community.description|markdown }}
                </div>
                {% endif %}
            </article>
            
            <article class="coverage-progress">
                <!-- div class="progress">
                    <h1>Progress</h1>
                    <img src="{% static 'ttn/media/progress.png' %}">
                </div -->
                <div class="clear"></div>
                <div id="map">Sorry, there was a Google Maps error.</div>
		<!-- https://developers.google.com/maps/documentation/staticmaps/intro -->
            </article>
            
        <article class="how-to-connect">
            <h1>Stay up to date</h1>
                <section class="article-text"><p>Want to know more about The Things Network? Sign up for our newsletter and receive all the important news.</p></section>
                <!-- Begin MailChimp Signup Form -->
                <div id="mc_embed_signup">
                    <form action="//thethingsnetwork.us11.list-manage.com/subscribe/post?u=20406705fec6d7d4b2ab1d6cc&amp;id=0b4108dfeb" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                        <div id="mc_embed_signup_scroll">
                            <div class="mc-field-group">
                                <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Fill in your email address">
                                <input type="hidden" value="{{ community.slug }}" name="CAMPAIGN" id="mce-CAMPAIGN">
                            </div>
	                       <div id="mce-responses" class="clear">
                                <div class="response" id="mce-error-response" style="display:none"></div>
                                <div class="response" id="mce-success-response" style="display:none"></div>
                               </div>
                            </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                            <div style="position: absolute; left: -5000px;"><input type="text" name="b_20406705fec6d7d4b2ab1d6cc_0b4108dfeb" tabindex="-1" value=""></div>
                            <div class="clear">
                            <br>
                                <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
                            </div>
                        </div>
                    </form>
                </div>
<!--End mc_embed_signup-->
        </article>    
            
            <article class="information">
                <section class="left-bar">
                    <h1>Contributors</h1>
                    {% for member in community.members.all %}
                    <img class="contributor" alt="{{ member.first_name }} {{ member.last_name }}"
                     src="{% if member.ttnuser.image_thumb_url %}{{ member.ttnuser.image_thumb_url }}{% else %}{% static 'ttn/media/team/newmember.png' %}{% endif %}">
                    {% endfor %}
                </section>
            
                <section class="center">
                    <div class="blog-posts">
                        <h1>Posts</h1>
                            {% if community.post_set.all %}
                            {% for post in community.post_set.all %}
                            <div class="blog-post">
                                <div class="blog-image"></div>
                                
                                    <div class="blog-text">
                                        <h4>{{ post.title }}</h4>
                                        <p>{{ post.description|truncatewords:50 }}</p>
                                        <a href="{% url 'ttn:community-post' slug=community.slug pk=post.pk %}">
                                            Read more
                                        </a>
                                    </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="blog-post">
                                <p>The {{ community.title }} community hasn't posted anything yet!</p>
                            </div>
                            {% endif %}
                    </div>
                </section>
            
                <section class="right-bar">
                    <h1>Media</h1>
                    {% if community.media_set.all %}
                    {% for medium in community.media_set.all %}
                    <div class="side-post">
                        <h4>{{ medium.title }}</h4>
                        <a href="{{ medium.url }}" target="_blank">read more</a>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="side-post">
                        The {{ community.title }} community is working on media attention!
                    </div>
                    {% endif %}

                    <div class="vseperator">&nbsp;</div>

                    <h1>Resources</h1>
                    {% if community.resource_set.all %}
                    {% for resource in community.resource_set.all %}
                    <div class="side-post">
                        <h4>{{ resource.title }}</h4>
                        <a href="{{ resource.url }}" target="_blank">have a look</a>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="side-post">
                        We don't have any external resources yet.
                    </div>
                    {% endif %}

                    <div class="contact">
                        <p><a href="{% url 'ttn:community-contact' slug=community.slug %}">
                            Contact us
                        </a></p>
                    </div>
                </section>
         </article>

{% endblock %}
